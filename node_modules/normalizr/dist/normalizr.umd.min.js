!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.normalizr=e.normalizr||{})}(this,function(e){"use strict";function t(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function n(e,t,n){return Object.keys(e).reduce(function(t,r){var i=""+r;return t.has(i)?t.set(i,n(t.get(i),e[i])):t},t)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s=function(e){return function(n){return t(n)?n.get(e):n[e]}},l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i(this,e),!t||"string"!=typeof t)throw new Error("Expected a string key for Entity, but found "+t+".");var o=r.idAttribute,u=void 0===o?"id":o,c=r.mergeStrategy,f=void 0===c?function(e,t){return a({},e,t)}:c,l=r.processStrategy,h=void 0===l?function(e){return a({},e)}:l;this._key=t,this._getId="function"==typeof u?u:s(u),this._idAttribute=u,this._mergeStrategy=f,this._processStrategy=h,this.define(n)}return o(e,[{key:"define",value:function(e){this.schema=Object.keys(e).reduce(function(t,n){var r=e[n];return a({},t,u({},n,r))},this.schema||{})}},{key:"getId",value:function(e,t,n){return this._getId(e,t,n)}},{key:"merge",value:function(e,t){return this._mergeStrategy(e,t)}},{key:"normalize",value:function(e,t,n,i,o){var u=this,a=this._processStrategy(e,t,n);return Object.keys(this.schema).forEach(function(e){if(a.hasOwnProperty(e)&&"object"===r(a[e])){var t=u.schema[e];a[e]=i(a[e],a,e,t,o)}}),o(this,a,e,t,n),this.getId(e,t,n)}},{key:"denormalize",value:function(e,r){var i=this;return t(e)?n(this.schema,e,r):(Object.keys(this.schema).forEach(function(t){if(e.hasOwnProperty(t)){var n=i.schema[t];e[t]=r(e[t],n)}}),e)}},{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),h=function(){function e(t,n){i(this,e),n&&(this._schemaAttribute="string"==typeof n?function(e){return e[n]}:n),this.define(t)}return o(e,[{key:"define",value:function(e){this.schema=e}},{key:"getSchemaAttribute",value:function(e,t,n){return!this.isSingleSchema&&this._schemaAttribute(e,t,n)}},{key:"inferSchema",value:function(e,t,n){if(this.isSingleSchema)return this.schema;var r=this.getSchemaAttribute(e,t,n);return this.schema[r]}},{key:"normalizeValue",value:function(e,t,n,r,i){var o=this.inferSchema(e,t,n);if(!o)return e;var u=r(e,t,n,o,i);return this.isSingleSchema||void 0===u||null===u?u:{id:u,schema:this.getSchemaAttribute(e,t,n)}}},{key:"denormalizeValue",value:function(e,n){var r=t(e)?e.get("schema"):e.schema;if(!this.isSingleSchema&&!r)return e;var i=t(e)?e.get("id"):e.id,o=this.isSingleSchema?this.schema:this.schema[r];return n(i||e,o)}},{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),y=function(e){function t(e,n){if(i(this,t),!n)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return c(t,e),o(t,[{key:"normalize",value:function(e,t,n,r,i){return this.normalizeValue(e,t,n,r,i)}},{key:"denormalize",value:function(e,t){return this.denormalizeValue(e,t)}}]),t}(h),d=function(e){function t(){return i(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),o(t,[{key:"normalize",value:function(e,t,n,r,i){var o=this;return Object.keys(e).reduce(function(t,n,c){var f=e[n];return void 0!==f&&null!==f?a({},t,u({},n,o.normalizeValue(f,e,n,r,i))):t},{})}},{key:"denormalize",value:function(e,t){var n=this;return Object.keys(e).reduce(function(r,i){var o=e[i];return a({},r,u({},i,n.denormalizeValue(o,t)))},{})}}]),t}(h),m=function(e){var t=Array.isArray(e);if(t&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]},p=function(e){return Array.isArray(e)?e:Object.keys(e).map(function(t){return e[t]})},v=function(e,t,n,r,i,o){e=m(e);var u=p(t);return u.map(function(t,u){return i(t,n,r,e,o)})},b=function(e,t,n){return e=m(e),t&&t.map?t.map(function(t){return n(t,e)}):t},g=function(e){function t(){return i(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),o(t,[{key:"normalize",value:function(e,t,n,r,i){var o=this,u=p(e);return u.map(function(e,u){return o.normalizeValue(e,t,n,r,i)}).filter(function(e){return void 0!==e&&null!==e})}},{key:"denormalize",value:function(e,t){var n=this;return e&&e.map?e.map(function(e){return n.denormalizeValue(e,t)}):e}}]),t}(h),k=function(e,t,n,r,i,o){var u=a({},t);return Object.keys(e).forEach(function(n){var r=e[n],a=i(t[n],t,n,r,o);void 0===a||null===a?delete u[n]:u[n]=a}),u},_=function(e,r,i){if(t(r))return n(e,r,i);var o=a({},r);return Object.keys(e).forEach(function(t){o[t]&&(o[t]=i(o[t],e[t]))}),o},O=function(){function e(t){i(this,e),this.define(t)}return o(e,[{key:"define",value:function(e){this.schema=Object.keys(e).reduce(function(t,n){var r=e[n];return a({},t,u({},n,r))},this.schema||{})}},{key:"normalize",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[this.schema].concat(t))}},{key:"denormalize",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return _.apply(void 0,[this.schema].concat(t))}}]),e}(),j=function e(t,n,i,o,u){if("object"!==("undefined"==typeof t?"undefined":r(t))||!t)return t;if("object"===("undefined"==typeof o?"undefined":r(o))&&(!o.normalize||"function"!=typeof o.normalize)){var a=Array.isArray(o)?v:k;return a(o,t,n,i,e,u)}return o.normalize(t,n,i,e,u)},S=function(e){return function(t,n,r,i,o){var u=t.key,a=t.getId(r,i,o);u in e||(e[u]={});var c=e[u][a];c?e[u][a]=t.merge(c,n):e[u][a]=n}},z={Array:g,Entity:l,Object:O,Union:y,Values:d},w=function(e,t){if(!e||"object"!==("undefined"==typeof e?"undefined":r(e)))throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+("undefined"==typeof e?"undefined":r(e))+'".');var n={},i=S(n),o=j(e,e,null,t,i);return{entities:n,result:o}},A=function(e,n,i,o,u){var c=o(e,n);if("object"!==("undefined"==typeof c?"undefined":r(c))||null===c)return c;if(u[n.key]||(u[n.key]={}),!u[n.key][e]){var f=t(c)?c:a({},c);u[n.key][e]=f,u[n.key][e]=n.denormalize(f,i)}return u[n.key][e]},E=function(e){var t={},n=P(e);return function e(i,o){if("object"===("undefined"==typeof o?"undefined":r(o))&&(!o.denormalize||"function"!=typeof o.denormalize)){var u=Array.isArray(o)?b:_;return u(o,i,e)}return void 0===i||null===i?i:o instanceof l?A(i,o,e,n,t):o.denormalize(i,e)}},P=function(e){var n=t(e);return function(t,i){var o=i.key;return"object"===("undefined"==typeof t?"undefined":r(t))?t:n?e.getIn([o,t.toString()]):e[o][t]}},x=function(e,t,n){if("undefined"!=typeof e)return E(n)(e,t)};e.schema=z,e.normalize=w,e.denormalize=x,Object.defineProperty(e,"__esModule",{value:!0})});
